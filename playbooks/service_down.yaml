id: service_down
match:
  alert_name: "ServiceDown"

steps:
  - check:
      tool: "get_service_health"
      input:
        service: "{{alert.service}}"

  - decide:
      when:
        equals:
          path: "ctx.service_health.status"
          value: "down"
      then:
        - action:
            tool: "restart_service"
            input:
              service: "{{alert.service}}"
        - verify:
            tool: "get_service_health"
            input:
              service: "{{alert.service}}"
      else:
        - action:
            tool: "notify"
            input:
              channel: "ops"
              message: "התקבלה התראת ServiceDown אבל השירות לא במצב down לפי בדיקה. נדרש בדיקה ידנית."

fallback:
  escalate: true
